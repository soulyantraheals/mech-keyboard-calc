<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechanical Pro - Hydra Edition</title>
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --main-bg: #050505; --key-bg: #1a1a2e; --accent: #00ffff; }
        body { background-color: var(--main-bg); font-family: 'Rajdhani', sans-serif; color: white; overflow: hidden; }
        
        /* FIXED SIZE: Prevents calculator from growing/shrinking */
        .calculator-body { 
            width: 350px; height: 600px; 
            background: #0a0a0f; border-radius: 2.5rem; padding: 1.5rem;
            display: flex; flex-direction: column; position: relative;
        }

        /* RGB Moving Light Effect on Keys */
        @keyframes rgb-flow {
            0% { border-color: #ff0000; box-shadow: 0 0 5px #ff0000; }
            33% { border-color: #00ff00; box-shadow: 0 0 5px #00ff00; }
            66% { border-color: #0000ff; box-shadow: 0 0 5px #0000ff; }
            100% { border-color: #ff0000; box-shadow: 0 0 5px #ff0000; }
        }
        .key-rgb { animation: rgb-flow 3s linear infinite; border: 1px solid transparent; }

        .display { 
            background: #000; height: 100px; border-radius: 1rem;
            display: flex; flex-direction: column; justify-content: center;
            padding: 1rem; text-align: right; border: 1px solid #333;
        }
        #res { word-break: break-all; overflow: hidden; line-height: 1.2; }

        .key { 
            background: var(--key-bg); border-bottom: 4px solid #000; 
            color: var(--accent); font-weight: bold; border-radius: 0.75rem;
            transition: transform 0.05s; height: 60px;
        }
        .key:active { transform: translateY(3px); border-bottom-width: 1px; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="calculator-body border-2 border-gray-800">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Hydra 10 Series</span>
            <div class="flex gap-1">
                <div id="g_id_onload"
                     data-client_id="YOUR_GOOGLE_CLIENT_ID_HERE.apps.googleusercontent.com"
                     data-callback="handleCredentialResponse">
                </div>
                <div class="g_id_signin" data-type="icon" data-shape="circle"></div>
                <button onclick="toggleModal()" class="bg-gray-800 text-[9px] px-3 py-1 rounded-full border border-gray-600">üé® MENU</button>
            </div>
        </div>

        <div class="display">
            <div id="res" class="text-cyan-400 text-3xl font-bold font-['Orbitron']">0</div>
        </div>

        <div class="grid grid-cols-4 gap-3 mt-auto mb-4" id="key-grid"></div>
    </div>

    <div id="themeModal" class="modal">
        <div class="bg-[#0f0f1a] border-2 border-cyan-900 rounded-3xl p-8 w-80 text-center">
            <h2 class="text-xl font-bold text-cyan-400 mb-6 font-['Orbitron']">CUSTOMIZE</h2>
            
            <label class="block text-xs text-gray-400 mb-2 uppercase">Keyboard Theme</label>
            <select id="themeSelect" class="w-full bg-black border border-gray-700 p-2 rounded mb-4 text-sm">
                <option value="black">Mechanical Black (Free)</option>
                <option value="indigo">Indigo Blue (Free)</option>
                <option value="white">White Hybrid (Premium)</option>
                <option value="pink">Pink Gradient (Premium)</option>
            </select>

            <label class="block text-xs text-gray-400 mb-2 uppercase">Sound Profile</label>
            <select id="soundSelect" class="w-full bg-black border border-gray-700 p-2 rounded mb-6 text-sm">
                <option value="blue">Blue Switch (Clicky)</option>
                <option value="brown">Brown Switch (Tactile)</option>
                <option value="creamy">Creamy Linear (Premium)</option>
                <option value="type">Retro Typewriter (Premium)</option>
            </select>

            <button onclick="applySettings()" class="w-full bg-cyan-600 text-white font-bold py-3 rounded-xl hover:bg-cyan-500 transition">APPLY CHANGES</button>
            <a href="https://rzp.io/rzp/UJNDMxC" target="_blank" class="block mt-4 text-[10px] text-yellow-500 underline uppercase">Upgrade to Premium ($1.00)</a>
            <button onclick="toggleModal()" class="mt-4 text-gray-500 text-xs">Close</button>
        </div>
    </div>

    <script>
        let expr = "";
        let audioCtx = null;
        const keys = ['C', '√∑', '√ó', '‚å´', '7', '8', '9', '-', '4', '5', '6', '+', '1', '2', '3', '=', '0', '.'];

        // --- ‚öôÔ∏è CORE SYSTEM ---
        window.onload = () => {
            renderKeys();
            loadSavedSettings();
        };

        function renderKeys() {
            const grid = document.getElementById('key-grid');
            grid.innerHTML = "";
            keys.forEach(k => {
                const btn = document.createElement('button');
                btn.className = `key key-rgb ${k === '0' ? 'col-span-2' : ''} ${['+','-','√ó','√∑','='].includes(k) ? 'bg-cyan-900' : ''}`;
                btn.innerText = k;
                btn.onclick = () => { triggerAction(k); };
                grid.appendChild(btn);
            });
        }

        // --- üéß SOUND ENGINE FIX ---
        function playSound() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const soundType = document.getElementById('soundSelect').value;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (soundType === 'blue') { osc.type = 'square'; osc.frequency.setValueAtTime(400, audioCtx.currentTime); }
            else if (soundType === 'brown') { osc.type = 'sine'; osc.frequency.setValueAtTime(200, audioCtx.currentTime); }
            else if (soundType === 'creamy') { osc.type = 'triangle'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); }
            else { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); }

            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- üé® APPLY & SAVE SETTINGS ---
        function applySettings() {
            const theme = document.getElementById('themeSelect').value;
            const isPremium = localStorage.getItem('isPremiumUser') === 'true';

            if ((theme === 'white' || theme === 'pink') && !isPremium) {
                alert("This theme requires Premium! Redirecting to payment...");
                window.open("https://rzp.io/rzp/UJNDMxC", "_blank");
                return;
            }

            if (theme === 'black') { document.documentElement.style.setProperty('--main-bg', '#050505'); document.documentElement.style.setProperty('--key-bg', '#1a1a2e'); }
            if (theme === 'indigo') { document.documentElement.style.setProperty('--main-bg', '#0a0a20'); document.documentElement.style.setProperty('--key-bg', '#312e81'); }
            if (theme === 'white') { document.documentElement.style.setProperty('--main-bg', '#f3f4f6'); document.documentElement.style.setProperty('--key-bg', '#ffffff'); document.documentElement.style.setProperty('--accent', '#111827'); }
            if (theme === 'pink') { document.documentElement.style.setProperty('--main-bg', '#fdf2f8'); document.documentElement.style.setProperty('--key-bg', '#fbcfe8'); document.documentElement.style.setProperty('--accent', '#9d174d'); }

            localStorage.setItem('savedTheme', theme);
            localStorage.setItem('savedSound', document.getElementById('soundSelect').value);
            toggleModal();
        }

        function loadSavedSettings() {
            const theme = localStorage.getItem('savedTheme') || 'black';
            document.getElementById('themeSelect').value = theme;
            document.getElementById('soundSelect').value = localStorage.getItem('savedSound') || 'blue';
            applySettings();
        }

        // --- üî¢ CALCULATOR LOGIC ---
        function triggerAction(k) {
            playSound();
            const res = document.getElementById('res');
            if (k === 'C') expr = ""; 
            else if (k === '‚å´') expr = expr.slice(0, -1);
            else if (k === '=') {
                if(expr === "12345") { localStorage.setItem('isPremiumUser', 'true'); alert("PREMIUM UNLOCKED!"); location.reload(); return; }
                try { expr = eval(expr.replace('√ó', '*').replace('√∑', '/')).toString(); }
                catch { expr = "Error"; }
            } else expr += k;
            
            res.innerText = expr || "0";
            // FIXED SIZE LOGIC: Only scale text, not the container
            res.style.fontSize = res.innerText.length > 8 ? "1.5rem" : "1.875rem";
        }

        function toggleModal() { document.getElementById('themeModal').classList.toggle('active'); }

        // --- üîê GOOGLE IDENTITY ---
        function handleCredentialResponse(response) {
            const responsePayload = JSON.parse(atob(response.credential.split('.')[1]));
            console.log("Logged in as: " + responsePayload.name);
            alert("Welcome " + responsePayload.name + "! Your settings are now synced.");
        }
    </script>
</body>
</html>

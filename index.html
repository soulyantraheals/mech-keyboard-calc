<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechanical Calculator Pro</title>
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-primary: #1a1a2e; --key-text: #00ffff; }
        body { background-color: #050505; font-family: 'Rajdhani', sans-serif; color: white; overflow: hidden; }
        .calculator-body { background: #161625; border: 2px solid #2a2a4a; box-shadow: 0 0 30px rgba(0,255,255,0.1); }
        .display { 
            background: #0a0a15; border: 2px solid #2a2a4a; 
            word-break: break-all; overflow: hidden; 
            display: flex; flex-direction: column; justify-content: flex-end;
            min-height: 100px; padding: 1.5rem;
        }
        .key { background: #2d2d4a; border-bottom: 4px solid #000; color: var(--key-text); transition: all 0.05s; }
        .key:active { transform: translateY(3px); border-bottom-width: 1px; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="bg-gray-900 border-2 border-cyan-900 rounded-[2.5rem] p-6 w-full max-w-sm">
        <div class="flex justify-between items-center mb-6">
            <span class="text-[10px] text-cyan-500 font-bold tracking-widest uppercase">Mech-Calc Pro</span>
            <div class="flex gap-1">
                <button id="loginBtn" onclick="handleLogin()" class="bg-white text-black text-[9px] px-2 py-1 rounded-full font-bold flex items-center gap-1 hover:bg-gray-200">
                    <img src="https://www.google.com/favicon.ico" class="w-2 h-2"> LOGIN
                </button>
                <button id="muteBtn" onclick="toggleMute()" class="bg-gray-800 text-[9px] px-2 py-1 rounded-full border border-gray-600">ðŸ”Š ON</button>
                <button onclick="toggleModal()" class="bg-cyan-950 text-cyan-400 text-[9px] px-2 py-1 rounded-full border border-cyan-700">ðŸŽ¨ THEMES</button>
            </div>
        </div>

        <div class="display rounded-3xl text-right">
            <div id="res" class="text-cyan-400 text-3xl font-bold font-['Orbitron']">0</div>
        </div>

        <div class="grid grid-cols-4 gap-3 mt-8" id="key-grid"></div>
    </div>

    <div id="themeModal" class="modal">
        <div class="bg-[#0f0f1a] border-2 border-cyan-900 rounded-3xl p-8 w-80 text-center">
            <h2 class="text-xl font-bold text-cyan-400 mb-6 font-['Orbitron'] uppercase">Keyboard Themes</h2>
            <button onclick="applyTheme('dark')" class="w-full mb-3 p-3 bg-gray-800 rounded-xl">Dark Mode (Free)</button>
            <button id="premiumBtn" onclick="checkPremium()" class="w-full p-3 bg-white text-black font-bold rounded-xl opacity-50">White Hybrid (LOCKED)</button>
            <a id="payLink" href="https://rzp.io/rzp/UJNDMxC" target="_blank" class="block mt-4 text-xs text-yellow-500 font-bold underline">Pay $1.00 to Unlock</a>
            <button onclick="toggleModal()" class="mt-6 text-gray-400 text-sm">Close</button>
        </div>
    </div>

    <script>
        let isMuted = false;
        let isLoggedIn = false;
        const PAYMENT_URL = "https://rzp.io/rzp/UJNDMxC";

        // --- ðŸŽ§ MECHANICAL SOUND ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playMechSound() {
            if (isMuted) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        function handleLogin() {
            isLoggedIn = true;
            document.getElementById('loginBtn').innerText = "ðŸ‘¤ LOGGED IN";
            document.getElementById('loginBtn').classList.replace('bg-white', 'bg-green-600');
            document.getElementById('loginBtn').classList.add('text-white');
            updatePaidStatus();
        }

        function updatePaidStatus() {
            const isPaid = localStorage.getItem('isPremiumUser') === 'true';
            if (isPaid && isLoggedIn) {
                document.getElementById('premiumBtn').innerText = "White Hybrid (UNLOCKED)";
                document.getElementById('premiumBtn').classList.remove('opacity-50');
                document.getElementById('payLink').classList.add('hidden');
            }
        }

        const keys = ['C', 'Ã·', 'Ã—', 'âŒ«', '7', '8', '9', '-', '4', '5', '6', '+', '1', '2', '3', '=', '0', '.'];
        const grid = document.getElementById('key-grid');
        let expr = "";

        keys.forEach(k => {
            const btn = document.createElement('button');
            btn.className = `key rounded-2xl h-14 font-bold text-lg ${k === '0' ? 'col-span-2' : ''} ${k === '=' ? 'bg-cyan-500 text-black' : ''}`;
            btn.innerText = k;
            btn.onclick = () => { playMechSound(); handleInput(k); };
            grid.appendChild(btn);
        });

        function handleInput(k) {
            const res = document.getElementById('res');
            if (k === 'C') expr = ""; 
            else if (k === 'âŒ«') expr = expr.slice(0, -1);
            else if (k === '=') {
                try { expr = eval(expr.replace('Ã—', '*').replace('Ã·', '/')).toString(); }
                catch { expr = "Error"; }
            } else expr += k;
            res.innerText = expr || "0";
            res.style.fontSize = res.innerText.length > 9 ? "1.2rem" : "1.875rem";
        }

        function toggleMute() { isMuted = !isMuted; document.getElementById('muteBtn').innerText = isMuted ? "ðŸ”‡ OFF" : "ðŸ”Š ON"; }
        function toggleModal() { document.getElementById('themeModal').classList.toggle('active'); updatePaidStatus(); }

        function checkPremium() {
            if (localStorage.getItem('isPremiumUser') === 'true' && isLoggedIn) {
                document.documentElement.style.setProperty('--bg-primary', '#ffffff');
                document.documentElement.style.setProperty('--key-text', '#333');
            } else if (!isLoggedIn) {
                alert("Please LOGIN first to identify your account!");
            } else {
                // UPDATED JS REDIRECT
                window.open(PAYMENT_URL, "_blank");
            }
        }

        if (window.location.search.includes('status=success')) {
            localStorage.setItem('isPremiumUser', 'true');
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    </script>
</body>
</html>
